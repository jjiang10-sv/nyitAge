FROM kalilinux/kali-rolling

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive
ENV DISABLE_BOOTSNAP=1

# Configure Wireshark installation
RUN echo 'wireshark-common wireshark-common/install-setuid boolean true' | debconf-set-selections

# Update and install required packages
RUN apt update --fix-missing && \
    apt install -y --fix-missing \
    iproute2 \
    nmap \
    net-tools \
    curl \
    iputils-ping \
    dnsutils \
    whois \
    nikto \
    hashcat \
    sqlmap \
    netcat-traditional \
    socat \
    tcpdump \
    tshark \
    aircrack-ng \
    masscan \
    gdb \
    gdb-multiarch \
    gdb-peda \
    gdb-pwndbg \
    gdb-gef \
    gdb-peda \
    zmap \
    jq \
    suricata && \
    apt remove --purge -y llvm-18* || true && \
    apt install -y metasploit-framework && \
    rm -rf /tmp/bootsnap* && \
    apt clean && \
    rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace

# Add capabilities for packet capture
RUN setcap cap_net_raw,cap_net_admin=eip /usr/bin/dumpcap

# The container will run indefinitely
CMD ["sleep", "infinity"]